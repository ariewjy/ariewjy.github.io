{
  "hash": "ec97b7b836503a0ffa81867cb0ece3f4",
  "result": {
    "markdown": "---\ntitle: 'Medical Insurance Cost [Part-1] '\ndescription: |\n  Understanding Insurance Medical dataset to answer if smoking, sex, body mass index (BMI) affects the medical charges.\nauthor: Aditya Arie Wijaya\ntitle-block-banner: true\ndate: '2022-10-27'\ncategories:\n  - project\n  - data-science\n  - python\ndraft: false\n---\n\n![Photo by <a href=\"https://unsplash.com/@towfiqu999999?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Towfiqu barbhuiya</a> on <a href=\"https://unsplash.com/s/photos/medical-care?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>\n  ](image.jpeg)\n\n## Introduction & Objectives\n\nHealth insurance plays an important role in future financial planning. Insurance members are required to pay a routine payment (insurance rates) to the insurance company. This rate will be used to pay medical bill of the insurance members. therefore, determination of insurance rate becomes a critical component to ensure the sustainability of the insurance.\n\nIn this project, the author wanted to do an exploratory analysis based on known variable that may correlate with the medical bill of the said members. This project will be using personal medical bills dataset ([insurance.zip](/posts/03-project-insurance-cost-part-1/insurance.zip)) as the main source[^1], along with the included metadata below:\n\n[^1]: also available at [Kaggle](https://www.kaggle.com/datasets/mirichoi0218/insurance).\n\n1. `age`: age of primary beneficiary\n1. `sex`: insurance contractor gender, female, male\n1. `bmi`: body mass index, providing an understanding of body, weights that are relatively high or low relative to height, objective index of body weight (`kg/m2`) using the ratio of height to weight, ideally `18.5` to `24.9`\n1. `children`: number of children covered by health insurance / number of dependents\n1. `smoker`: smoking\n1. `region`: the beneficiary's residential area in the US, northeast, southeast, southwest, northwest.\n1. `charges`: individual medical costs billed by health insurance\n\nAt glance, bmi and smoker would likely to induce a high medical cost of a person, while age, sex, children and region may contribute in some senses or the others. \n\nObjectives:\n\n- Analyze the **relationship** between multiple `variables` to `medical charges`\n- Characterize the **risk profile** of members, based on the said analysis\n- Determine if the **insurance rate** can be optimized for each `risk profile`\n\n## Setting-up\n\n::: {.cell execution_count=1}\n``` {.python .cell-code code-fold=\"false\"}\n#importing libraries\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport altair as alt\nimport hvplot.pandas\n\n#setting default theme\nsns.set_theme(style='white', palette='tab20') \n```\n:::\n\n\n## Importing Dataset\n\n::: {.cell execution_count=2}\n``` {.python .cell-code code-fold=\"false\"}\ninsurance = pd.read_csv('insurance.zip')\ninsurance.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=98}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>age</th>\n      <th>sex</th>\n      <th>bmi</th>\n      <th>children</th>\n      <th>smoker</th>\n      <th>region</th>\n      <th>charges</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>19</td>\n      <td>female</td>\n      <td>27.900</td>\n      <td>0</td>\n      <td>yes</td>\n      <td>southwest</td>\n      <td>16884.92400</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>18</td>\n      <td>male</td>\n      <td>33.770</td>\n      <td>1</td>\n      <td>no</td>\n      <td>southeast</td>\n      <td>1725.55230</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>28</td>\n      <td>male</td>\n      <td>33.000</td>\n      <td>3</td>\n      <td>no</td>\n      <td>southeast</td>\n      <td>4449.46200</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>33</td>\n      <td>male</td>\n      <td>22.705</td>\n      <td>0</td>\n      <td>no</td>\n      <td>northwest</td>\n      <td>21984.47061</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>32</td>\n      <td>male</td>\n      <td>28.880</td>\n      <td>0</td>\n      <td>no</td>\n      <td>northwest</td>\n      <td>3866.85520</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Feature Engineering\n\nIn this dataset, the BMI is a numeric data. In order to better analyze the dataset, the bmi data can be grouped into different class/group. The classification in this project will be using [BMI classification](https://www.cdc.gov/healthyweight/assessing/bmi/adult_bmi/index.html) below:\n\n| BMI            | Weight Status  |\n|----------------|----------------|\n| Below 18.5     | Underweight    |\n| 18.5 – 24.9    | Healthy Weight |\n| 25.0 – 29.9    | Overweight     |\n| 30.0 and Above | Obesity        |\n\n<!-- :::{.callout-note}\nFor more granular grouping, the [classification](https://www.calculator.net/bmi-calculator) below may be used.\n\n| Category          | BMI range - kg/m2 |\n|-------------------|-------------------|\n| Severe Thinness   | < 16              |\n| Moderate Thinness | 16 - 17           |\n| Mild Thinness     | 17 - 18.5         |\n| Normal            | 18.5 - 25         |\n| Overweight        | 25 - 30           |\n| Obese Class I     | 30 - 35           |\n| Obese Class II    | 35 - 40           |\n| Obese Class III   | > 40              |\n::: -->\n\nWe can use `pandas.cut` method to create a quick binning over `bmi` column.\n\n::: {#tbl-bmi-class .cell tbl-cap='BMI Class' execution_count=3}\n``` {.python .cell-code code-fold=\"false\"}\nbins= [0,18.49,24.9,30,100] #setting up the group based on bmi bins \nlabels = [\n         'underweight',\n         'healthy',\n         'overweight',\n         'obese'\n         ] #setting up the label on each group\n\ninsurance['bmi_class']= pd.cut(\n   insurance['bmi'], \n   bins=bins, \n   labels=labels,\n   include_lowest=False\n   ) #making the new column called bmi_class\n\n#sanity check on bmi_class\n(insurance\n .groupby('bmi_class')\n [['bmi', 'bmi_class']]\n .agg(['min', 'max', 'count'])\n # .style.background_gradient()\n # .style.text_gradient()\n#  .T\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=99}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th colspan=\"3\" halign=\"left\">bmi</th>\n      <th colspan=\"3\" halign=\"left\">bmi_class</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th>min</th>\n      <th>max</th>\n      <th>count</th>\n      <th>min</th>\n      <th>max</th>\n      <th>count</th>\n    </tr>\n    <tr>\n      <th>bmi_class</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>underweight</th>\n      <td>15.96</td>\n      <td>18.335</td>\n      <td>20</td>\n      <td>underweight</td>\n      <td>underweight</td>\n      <td>20</td>\n    </tr>\n    <tr>\n      <th>healthy</th>\n      <td>18.50</td>\n      <td>24.890</td>\n      <td>222</td>\n      <td>healthy</td>\n      <td>healthy</td>\n      <td>222</td>\n    </tr>\n    <tr>\n      <th>overweight</th>\n      <td>24.97</td>\n      <td>30.000</td>\n      <td>391</td>\n      <td>overweight</td>\n      <td>overweight</td>\n      <td>391</td>\n    </tr>\n    <tr>\n      <th>obese</th>\n      <td>30.02</td>\n      <td>53.130</td>\n      <td>705</td>\n      <td>obese</td>\n      <td>obese</td>\n      <td>705</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n@tbl-bmi-class shows a new column `bmi_class` as the result of grouping the bmi data into different categories.\n\n## Quicklook\n\n::: {.cell execution_count=4}\n``` {.python .cell-code code-fold=\"false\"}\ninsurance.info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 1338 entries, 0 to 1337\nData columns (total 8 columns):\n #   Column     Non-Null Count  Dtype   \n---  ------     --------------  -----   \n 0   age        1338 non-null   int64   \n 1   sex        1338 non-null   object  \n 2   bmi        1338 non-null   float64 \n 3   children   1338 non-null   int64   \n 4   smoker     1338 non-null   object  \n 5   region     1338 non-null   object  \n 6   charges    1338 non-null   float64 \n 7   bmi_class  1338 non-null   category\ndtypes: category(1), float64(2), int64(2), object(3)\nmemory usage: 74.8+ KB\n```\n:::\n:::\n\n\nThe data appears to be clean, with no null row, and dftypes appear to be correct. However, the format appears to be a non-tidy format. \n\n::: {.cell execution_count=5}\n``` {.python .cell-code code-fold=\"false\"}\n(insurance\n .select_dtypes(include=object) #includes all column with object dtypes\n .value_counts() #counting unique value\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=101}\n```\nsex     smoker  region   \nfemale  no      southwest    141\n                southeast    139\n                northwest    135\nmale    no      southeast    134\nfemale  no      northeast    132\nmale    no      northwest    132\n                southwest    126\n                northeast    125\n        yes     southeast     55\n                northeast     38\n                southwest     37\nfemale  yes     southeast     36\n                northeast     29\n                northwest     29\nmale    yes     northwest     29\nfemale  yes     southwest     21\ndtype: int64\n```\n:::\n:::\n\n\n**Some observations:**\n\n+ `2` categorical data in `sex` column: `female` and `male`\n+ `2` categorical data in the `smoker` column, `yes` or `no`\n+ `4` categorical data in the `region` column: `southwest`, `northwest`, `southeast`, and `northeast`\n\n::: {.callout-important}\nThe first attempt is to see the distribution on each variable relative to each other, depending on different categories. For example, comparing mean `age` between smoker and non-smoker group, `age` between low and high `bmi` class, etc. \n\nThen trying to understand the `relationship` of each variable with respect to the `medical charges`\n:::\n\n## Exploratory Data Analysis\n\nAs many people know, smoking is highly linked to clinical disease such as *TBC, lung cancer, hypertension*, etc. People with `smoking` history, may be considered a **high risk profile**, and as the likely outcome the **medical charges may be higher** than a non-smoker people. \n\n### Overall Mean age of insurance member\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\n(sns\n .displot(\n     data=insurance, \n     x='age', \n     hue='smoker',\n     kind='hist',\n     height=3,\n     aspect=1.2,\n )\n);\n```\n\n::: {.cell-output .cell-output-display}\n![Overall Mean Age](index_files/figure-html/fig-mean-age-output-1.png){#fig-mean-age width=415 height=272}\n:::\n:::\n\n\nBased on distribution at @fig-mean-age, the mean age for all insurance members is around `39` years old. There is also higher number of non-smoker compared to the total data (`2 times higher`) compared to smoker. There is an `anomaly frequency around age of 20` that has up to 4 times higher counts. **May need further check**. \n\n### Mean `age`, `bmi` and `charges` of `smoker` at different `sex`\n\n::: {#tbl-smoker-based-on-sex .cell tbl-cap='Statistic of Age, BMI, and Charges by Smoker and Sex' execution_count=7}\n``` {.python .cell-code}\n(insurance\n .groupby([\n     'smoker',\n     'sex'\n ])\n \n [[\n     'age',\n     'bmi',\n     'charges'\n  ]]\n \n .agg([\n     'mean', \n ])\n#  .style.background_gradient(\n#      axis=0,\n#      cmap=\"Blues\"\n#  )\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=103}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th></th>\n      <th>age</th>\n      <th>bmi</th>\n      <th>charges</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th></th>\n      <th>mean</th>\n      <th>mean</th>\n      <th>mean</th>\n    </tr>\n    <tr>\n      <th>smoker</th>\n      <th>sex</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">no</th>\n      <th>female</th>\n      <td>39.691042</td>\n      <td>30.539525</td>\n      <td>8762.297300</td>\n    </tr>\n    <tr>\n      <th>male</th>\n      <td>39.061896</td>\n      <td>30.770580</td>\n      <td>8087.204731</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">yes</th>\n      <th>female</th>\n      <td>38.608696</td>\n      <td>29.608261</td>\n      <td>30678.996276</td>\n    </tr>\n    <tr>\n      <th>male</th>\n      <td>38.446541</td>\n      <td>31.504182</td>\n      <td>33042.005975</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nCalculating the **ratio** of smoker to non-smoker group\n\n::: {#tbl-ratio-smoker .cell tbl-cap='Ratio of Charges based on Smoker profile' execution_count=8}\n``` {.python .cell-code}\n(insurance\n .groupby('smoker')\n [['charges']]\n .agg([np.mean])/8434.268298 #to calculate how high the smoker medical charges\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=104}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th>charges</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th>mean</th>\n    </tr>\n    <tr>\n      <th>smoker</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>no</th>\n      <td>1.000000</td>\n    </tr>\n    <tr>\n      <th>yes</th>\n      <td>3.800001</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nBased on the above @tbl-smoker-based-on-sex, the `male bmi is always higher` than the female counterpart, irrespective of its sex. Furthermore, the `average bmi for smoker is slightly higher than non-smoker group`. \n\nOn the other hand, `the average age for female is always higher` than its male counterpart, regardless of smoker or non-smoker.\n\nAs indicated by @tbl-ratio-smoker, the medical charges for is much higher in the smoker member, compared to non-smoker member, with up to `4 times higher for smoker`\n\n::: {#tbl-ratio-sex .cell tbl-cap='Ratio of Charges based on Sex profile' execution_count=9}\n``` {.python .cell-code}\n(insurance\n .groupby('sex')\n [['charges']]\n .agg([np.mean])/12569.578844 #to calculate how high the smoker medical charges\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=105}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th>charges</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th>mean</th>\n    </tr>\n    <tr>\n      <th>sex</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>female</th>\n      <td>1.000000</td>\n    </tr>\n    <tr>\n      <th>male</th>\n      <td>1.110359</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nFurthermore, @tbl-ratio-sex shows that male has 10% higher medical charges compared to female counterpart.\n\n#### Distribution of `age` categorized based on `sex`, `smoker`, and `bmi_class`\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\n(sns\n .catplot\n (data=insurance,\n  kind='box',\n  x='age', \n  y='smoker',\n  hue='bmi_class',\n  col='sex',\n  # col_wrap=1,\n  height=4,\n  aspect=0.7,\n  # showmeans=True,\n  palette='Blues',\n )\n);\n```\n\n::: {.cell-output .cell-output-display}\n![Age distribution based on Categorical values](index_files/figure-html/fig-boxplot-age-output-1.png){#fig-boxplot-age width=647 height=368}\n:::\n:::\n\n\nThe above @fig-boxplot-age age shows a the distribution of age between smoker, bmi_class and different sex in the data. As can be seen, there is a clear `trend of non-smoker where as the age increases`, the bmi increases also, in both male and female group.\n\nWhereas in the `smoker group, there is no clear trend of age vs bmi`. This can be further checked when using scatterplot between age and bmi vs charges.\n\n### Does `region` affecting the `age` distribution?\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\n(sns\n .catplot\n (data=insurance,\n  kind='box',\n  x='age', \n  y='smoker',\n  hue='bmi_class',\n  col='region',\n  col_wrap=2,\n  height=4,\n  aspect=0.7,\n  showmeans=True,\n  palette='Blues',\n )\n);\n```\n\n::: {.cell-output .cell-output-display}\n![Age distribution based on region](index_files/figure-html/fig-boxplot-region-output-1.png){#fig-boxplot-region width=647 height=752}\n:::\n:::\n\n\nAs can be seen in @fig-boxplot-region, the region category does not seem to bring any value to the analysis, as the pattern with/ without region data is unclear. **May need further check**.\n\n#### Inspecting the `age` vs `charges` based on `smoker`, `sex`, and `bmi_class` profile\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\ng=(sns\n.relplot\n (data=insurance,\n  x='age',\n  y='charges',\n  hue='smoker',\n  size='bmi_class',\n  style='sex',\n  # legend='full',\n  # col='bmi_class',\n  # col_wrap=1,\n  height=3.5, \n  aspect=1.2,\n  markers=[\"8\",\"P\"],\n  palette='tab10',\n  size_order=['obese', 'overweight', 'healthy', 'underweight']\n )\n);\n\n#setting up annotations\n\ng.fig.text(0.6, 0.25, \"I\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\ng.fig.text(0.6, 0.45, \"II\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\ng.fig.text(0.6, 0.7, \"III\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\nplt.suptitle('age vs charges', y = 1.05);\n```\n\n::: {.cell-output .cell-output-display}\n![Age vs Charges](index_files/figure-html/fig-age-charges-1-output-1.png){#fig-age-charges-1 width=501 height=354}\n:::\n:::\n\n\n@fig-age-charges-1 shows at least three groups of trend with a strong relationship between medical `charges` and `age`. As the age increases, the medical charges increases. \n\n**The three group of medical charges are as follows:**\n\n+ group I: `16000` and below\n+ group II: `16000-30000`\n+ group III: above `30000`\n\nThe three group of `trends` were heavily `affected` by the smoker/ non-smoker group, as the highest group III appears to have more points with `obese` bmi_class. This can be further checked if we exclude non-smoker group and hue it by bmi_class, and we can put sex as the column category.\n\n### Does `sex` affects `age` vs `charges` distribution/trend?\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\n(sns\n.relplot\n (data=insurance\n  # .query(\"smoker=='yes'\")\n  ,\n  x='age',\n  y='charges',\n  hue='bmi_class',\n  size='bmi_class',\n  style='smoker',\n  # legend='full',\n  col='sex',\n#   col_wrap=1,\n  # row='smoker',\n  height=4, \n  aspect=0.7,\n  markers=[\"8\",\"P\"],\n  s=300,\n  palette='tab10',\n  alpha=0.7,\n  size_order=['obese', 'overweight', 'healthy', 'underweight'],\n  \n )\n)\n\nplt.suptitle('age vs charges | separated by male vs female', y = 1.05);\n```\n\n::: {.cell-output .cell-output-display}\n![Age vs Charges based on Sex](index_files/figure-html/fig-age-charges-2-output-1.png){#fig-age-charges-2 width=643 height=405}\n:::\n:::\n\n\n**Couple conclusions can be drawn from these @fig-age-charges-1 and @fig-age-charges-2:**\n\n1. That the `male is likely to have higher medical charges` compared to female, with relatively small difference (@tbl-ratio-sex).\n1. There are three groups of strong trend between age vs charges, where as the age increases in all trends, the medical charges is likely to increases as well.\n1. The three groups can be characterized from low-high charges as follows:\n    1. Group `I`: medical charges between `0-16,000`, predominantly `non-smoker`,and a mix between all bmi_class.\n    1. Group `II`: medical charges between `12,000-30,000`, a mix between `smoker and non-smoker group`, and bmi_class of healthy and `overweight`.\n    1. Group `III`: medical charges above `30,000`, predominantly `obese` bmi_class and `smoker`. \n\n### Some observed `outlier (group I-a)` between group I and II?\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\ng = (sns\n.relplot\n (data=insurance,\n  x='age',\n  y='charges',\n  hue='bmi_class',\n  size='bmi_class',\n  style='smoker',\n  # legend='full',\n  col='smoker',\n  # col_wrap=1,\n  # row='smoker',\n  height=4, \n  aspect=0.7,\n  markers=[\"8\",\"P\"],\n  s=300,\n  palette='tab10',\n  alpha=0.7,\n  size_order=['obese', 'overweight', 'healthy', 'underweight'],\n )\n);\n\n#annotations\n\ng.fig.text(0.6, 0.22, \"I\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\ng.fig.text(0.3, 0.4, \"II\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\ng.fig.text(0.3, 0.63, \"III\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\ng.fig.text(0.65, 0.4, \"I-a\",\n   color=\"black\", fontdict=dict(size=20), fontweight='bold'\n          )\n\n\nplt.suptitle('age vs charges | separated by smoker vs non-smoker', y = 1.05);\n```\n\n::: {.cell-output .cell-output-display}\n![Outliers?](index_files/figure-html/fig-outlier-output-1.png){#fig-outlier width=643 height=405}\n:::\n:::\n\n\nIf we look at the above @fig-outlier, in the non-smoker group, there is a cloud of data below the group II is. This needs further check, as what would affect the scattered data across this category, as it looks like there is another factor (aside from what was plotted already) that affects the data \"**moves up**\" (`increased medical charges`)\n\n### What affects the `outlier/ I-a` group?\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\n(sns\n.relplot\n (data=insurance.query('smoker == \"no\"'),\n  x='age',\n  y='charges',\n  hue='bmi_class',\n  # size='children',\n  style='sex',\n  legend='full',\n  col='children',\n  col_wrap=2,\n  # row='region',\n  height=3, \n  aspect=1,\n#   markers=[\"8\",\"P\"],\n  # s=400,\n  palette='tab10',\n  alpha=0.7,\n  # size_order=['obese', 'overweight', 'healthy', 'underweight'],\n )\n);\n```\n\n::: {.cell-output .cell-output-display}\n![Outliers vs number of Children](index_files/figure-html/fig-outlier-eda-output-1.png){#fig-outlier-eda width=683 height=848}\n:::\n:::\n\n\n@fig-outlier-eda shows just group I and I-a where we see through zero to six number of `childrens`, colored by `bmi_class` and styled by `sex`. As can be seen, **`there is no clear differentiator between group I and I-a`**, as the number of children increases, it affects both group I and I-a also. \n\n::: {.callout-important}\nIt is unclear as to why this is happening. Perhaps other factors plays a role. At the time of this writing, author decided to categorized the group `I-a` as the outlier.\n:::\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\ng = (sns\n.relplot\n (data=insurance,\n  x='bmi',\n  y='charges',\n  hue='smoker',\n  size='children',\n  # style='sex',\n  # legend='full',\n  # col='bmi_class',\n  # col_wrap=1,\n  height=3.5, \n  aspect=1,\n  markers=[\"8\",\"P\"],\n  palette='tab10',\n  size_order=[1,2,3,4,5,6]\n )\n)\n\n#annotations\ng.fig.text(0.35, 0.25, \"I\",\n   color=\"black\", fontdict=dict(size=18), fontweight='bold'\n          )\n\ng.fig.text(0.35, 0.45, \"II\",\n   color=\"black\", fontdict=dict(size=18), fontweight='bold'\n          )\n\ng.fig.text(0.6, 0.65, \"III\",\n   color=\"black\", fontdict=dict(size=18), fontweight='bold'\n          )\n\ng.fig.text(0.5, 0.45, \"I-a\",\n   color=\"black\", fontdict=dict(size=18), fontweight='bold'\n          )\n\nplt.suptitle('bmi vs charges', y = 1.05);\n```\n\n::: {.cell-output .cell-output-display}\n![BMI vs Charges](index_files/figure-html/fig-bmi-charges-output-1.png){#fig-bmi-charges width=388 height=354}\n:::\n:::\n\n\nSimilar to the previous @fig-age-charges-2, in @fig-bmi-charges we can see that the non-smoker group overlaps with the smoker group at around `16,000-30,000` medical charge range. \n\n## Conclusions and Outcomes\n\n1. The insurance member can be characterzed based on the `smoker` profile, `age`, `bmi`/ `bmi_class`, and `sex` profile.\n\n1. The `critical` factor for a high medical charges is whether member is a `smoker` or not, followed by `age` and then `bmi`[^2]. \n\n      [^2]: the lowest medical charges (group I) may have obese in their profile, but since it is a non-smoker profile, the medical charges is lower.\n\n1. Other variable such as the `number of children`/ dependant is not playing a role, whereas `sex` profile `affect the charges slightly`[^3]. \n\n      [^3]: around 10% higher in male, compared to female counterpart (see @tbl-ratio-sex)\n\n1. There is a `strong relationship between age and medical charges`, with `3` strong group categorized by `smoker` and `bmi` profile. The big three groups are:\n    + Group I: medical **charges below 16k**,`non-smoker`[^4].\n    + Group II: medical **charges between 16k-30k**, `smoker` and `overweight`.\n    + Group III: medical **charges above 30k**, `smoker` and `obese`.\n\n    These three groups have its own trendline which can be later determined (trendline).\n\n1. There is also one `outlier` or group `I-a`, where it is `unclear as to what affects the medical charges increase` to be between group I and II.\n\n[^4]: the BMI class shows a mix of all classes (from underweight to obese)\n\nThe above groups (`I, II, III`) can be used for **`risk profiling`**, where based on its profile, the associated risk related to medical charges can be determined. Since each group forms a trendline (simple linear regression), and can be categorized based on its smoker, and bmi profile. Based on this approach, one can estimate the optimum pricing for each risk profile (based on its medical charges). \n\nSee below flowchart for simple ilustration.\n\n\n```{mermaid}\n%%| echo: false\nflowchart LR\n    A[Member] --> B{Smoking}\n    B --> |No| C[trendline Group I]\n    B --> |Yes| D{BMI Class}\n    D --> |Overweight| E[trendline Group II]\n    D --> |Obese| F[trendline Group III]\n```\n\n\n::: {.callout-note}\nThe next step would be using some of these knowledge to further investigate the likelihood (probability) of each risk profile based on its numeric (age-bmi) and categorical variable (smoker-bmi-region-sex).\n:::\n\n\n-------\n\n::: {.callout-important}\nThis article was made as a replacement for medium article as part of Pacmann Data Science bootcamp assignment for Linear Algebra batch 8. The EDA notebook can be found in this [notebook](https://github.com/ariewjy/ariewjy.github.io/blob/main/posts/03-project-insurance-cost-part-1/eda/aditya-66kK_capstone.ipynb). Inside there will be a [Youtube](https://youtu.be/Zdtwk_hAqIg) link as part of the assignment also. \n:::\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}