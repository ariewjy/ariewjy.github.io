<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aditya Arie Wijaya">
<meta name="dcterms.date" content="2023-02-10">
<meta name="description" content="Web-scraping property ads listing in Kuala Lumpur, Malaysia, and built a machine learning model to predict the rent price.">

<title>Geoscientist Who Codes - Easy Report: Malaysia Property Pricing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/logo_rounded.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.scss">
<meta property="og:title" content="Geoscientist Who Codes - Easy Report: Malaysia Property Pricing">
<meta property="og:description" content="TLDR version of web-scraping property ads listing in Kuala Lumpur, Malaysia, and built a machine learning model to predict the rent price.">
<meta property="og:site-name" content="Geoscientist Who Codes">
<meta name="twitter:title" content="Geoscientist Who Codes - Easy Report: Malaysia Property Pricing">
<meta name="twitter:description" content="TLDR version of web-scraping property ads listing in Kuala Lumpur, Malaysia, and built a machine learning model to predict the rent price.">
<meta name="twitter:image" content="ariewjy.github.io/img/profile.jpg">
<meta name="twitter:creator" content="@Adtarie">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Geoscientist Who Codes</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html">
 <span class="menu-text">Publications</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Easy Report: Malaysia Property Pricing</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block">Easy Report: Malaysia Property Pricing</h1>
                  <div>
        <div class="description">
          <p>Web-scraping property ads listing in Kuala Lumpur, Malaysia, and built a machine learning model to predict the rent price.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">project</div>
                <div class="quarto-category">data-science</div>
                <div class="quarto-category">python</div>
                <div class="quarto-category">webscraping</div>
                <div class="quarto-category">report</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Aditya Arie Wijaya </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#who-is-this-for" id="toc-who-is-this-for" class="nav-link" data-scroll-target="#who-is-this-for">Who is this for?</a></li>
  <li><a href="#related-work" id="toc-related-work" class="nav-link" data-scroll-target="#related-work">Related work</a></li>
  <li><a href="#dataset-features" id="toc-dataset-features" class="nav-link" data-scroll-target="#dataset-features">Dataset &amp; features</a>
  <ul class="collapse">
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description">Data Description</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#experiments" id="toc-experiments" class="nav-link" data-scroll-target="#experiments">Experiments</a>
  <ul class="collapse">
  <li><a href="#extracting-near-ktmlrt" id="toc-extracting-near-ktmlrt" class="nav-link" data-scroll-target="#extracting-near-ktmlrt">Extracting Near KTM/LRT</a></li>
  <li><a href="#drop-unnecessary-missing-values" id="toc-drop-unnecessary-missing-values" class="nav-link" data-scroll-target="#drop-unnecessary-missing-values">Drop Unnecessary Missing Values</a></li>
  <li><a href="#outlier-removal" id="toc-outlier-removal" class="nav-link" data-scroll-target="#outlier-removal">Outlier Removal</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#best-model-from-train-dataset" id="toc-best-model-from-train-dataset" class="nav-link" data-scroll-target="#best-model-from-train-dataset">Best Model from Train Dataset</a></li>
  <li><a href="#applied-model-on-test-dataset" id="toc-applied-model-on-test-dataset" class="nav-link" data-scroll-target="#applied-model-on-test-dataset">Applied Model on Test Dataset</a></li>
  <li><a href="#feature-importance" id="toc-feature-importance" class="nav-link" data-scroll-target="#feature-importance">Feature Importance</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#future-works" id="toc-future-works" class="nav-link" data-scroll-target="#future-works">Future works</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Photo by <a href="https://unsplash.com/@esmonde?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Esmonde Yong</a> on <a href="https://unsplash.com/photos/-9B08uduMyY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></figcaption><p></p>
<p><img src="kuala_lumpur_twin_owers.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>This is a machine learning project to predict unit/property monthly rent price in Kuala Lumpur region, Malaysia. The project uses a dataset from an online ads listing for property <a href="https://www.mudah.my/">mudah.my</a>. This project outlines the process of web-scraping/ data gathering, data cleaning-wrangling, and machine learning modeling.</p>
<p>This project aims to answers question about how much a unit monthly rent would be if given information such as location, number of bedrooms, parking, furnished, etc? This would help potential tenant and also the owner to get the best price of their rental unit, comparable to the market value.</p>
<p>Some previous work about house pricing was listed below, however most of them are targeting a dataset of house pricing or an Airbnb pricing. There are difference such as in Airbnb, the booking rarely took more than 2 weeks, let alone a year. Therefore the pricing may be different. Additionally, in Airbnb, there is text feature coming from the review given by the tenant and the owner.The better the review, the higher the rent prices – which was not available in this current project dataset.</p>
</section>
<section id="who-is-this-for" class="level2">
<h2 class="anchored" data-anchor-id="who-is-this-for">Who is this for?</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This project was the TLDR-version of the <a href="https://ariewjy.github.io/posts/05-webscraping-machinelearning-house-pricing/" title="EDA and more details">complete article</a> where author explained in much more details about the process of webscraping-data cleaning-data wrangling-feature engineering, etc. This was made also as a mandatory terms for me to pass the Pacmann bootcamp intro to machine learning class. Video of me explaining the whole project is also available under this <a href="https://youtu.be/uoFtf7aFZJE">link</a>.</p>
</div>
</div>
</section>
<section id="related-work" class="level2">
<h2 class="anchored" data-anchor-id="related-work">Related work</h2>
<p>Previous work by <span class="citation" data-cites="madhuri2019">Madhuri, Anuradha, and Pujitha (<a href="#ref-madhuri2019" role="doc-biblioref">2019</a>)</span>, <span class="citation" data-cites="xu2022">Xu and Nguyen (<a href="#ref-xu2022" role="doc-biblioref">2022</a>)</span>, and <span class="citation" data-cites="zhao2022">Zhao et al. (<a href="#ref-zhao2022" role="doc-biblioref">2022</a>)</span> highlight the importance feature selection, and the choice of machine learning model. Based on the previous works, the most consistently performed machine learning model are Random Forest and Gradient boosting, and the MAE and R2 score usually used in evaluating the performance of the model. Although the above work are all not about apartment rent pricing, similar method can be applied to this project.</p>
</section>
<section id="dataset-features" class="level2">
<h2 class="anchored" data-anchor-id="dataset-features">Dataset &amp; features</h2>
<p>The dataset is using the scraped dataset from ads listing website, particularly property-to-rent surrounding Kuala Lumpur, Malaysia.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Why Webscraping?
</div>
</div>
<div class="callout-body-container callout-body">
<p>As 80% of data science process is about data engineering, from collection (gathering) to wrangling/ cleaning, author fells the need to brush up the skill, from available online data, relevant to the author (location: Kuala Lumpur), using webscraping tool such as BeaufifulSoup.</p>
<p>Detail of the web-scraping process on this project can be found in this <a href="https://ariewjy.github.io/posts/05-webscraping-machinelearning-house-pricing/" title="EDA and more details">article</a>.</p>
</div>
</div>
<p>There are over 10k ads listed at the time of this project as can be seen below:</p>
<p><img src="mudah_my.png" width="100%"></p>
<section id="data-description" class="level3">
<h3 class="anchored" data-anchor-id="data-description">Data Description</h3>
<div class="cell" data-execution_count="1">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#importing libraries</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6"></a>pd.set_option(<span class="st">'max_colwidth'</span>, <span class="dv">200</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">import</span> re</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#reload the data</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"./mudah-apartment-clean.csv"</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a>df.head(<span class="dv">2</span>).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ads_id</th>
      <td>100323185</td>
      <td>100203973</td>
    </tr>
    <tr>
      <th>prop_name</th>
      <td>The Hipster @ Taman Desa</td>
      <td>Segar Courts</td>
    </tr>
    <tr>
      <th>completion_year</th>
      <td>2022.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>monthly_rent</th>
      <td>RM 4 200 per month</td>
      <td>RM 2 300 per month</td>
    </tr>
    <tr>
      <th>location</th>
      <td>Kuala Lumpur - Taman Desa</td>
      <td>Kuala Lumpur - Cheras</td>
    </tr>
    <tr>
      <th>property_type</th>
      <td>Condominium</td>
      <td>Condominium</td>
    </tr>
    <tr>
      <th>rooms</th>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>parking</th>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>bathroom</th>
      <td>6.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>size</th>
      <td>1842 sq.ft.</td>
      <td>1170 sq.ft.</td>
    </tr>
    <tr>
      <th>furnished</th>
      <td>Fully Furnished</td>
      <td>Partially Furnished</td>
    </tr>
    <tr>
      <th>facilities</th>
      <td>Minimart, Gymnasium, Security, Playground, Swimming Pool, Parking, Lift, Barbeque area, Multipurpose hall, Jogging Track</td>
      <td>Playground, Parking, Barbeque area, Security, Jogging Track, Swimming Pool, Gymnasium, Lift, Sauna</td>
    </tr>
    <tr>
      <th>additional_facilities</th>
      <td>Air-Cond, Cooking Allowed, Washing Machine</td>
      <td>Air-Cond, Cooking Allowed, Near KTM/LRT</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>There are 13 features with one unique ids (<code>ads_id</code>) and one target feature (<code>monthly_rent</code>)</p>
<ul>
<li><code>ads_id</code>: the listing ids (unique)</li>
<li><code>prop_name</code>: name of the building/ property</li>
<li><code>completion_year</code>: completion/ established year of the property</li>
<li><code>monthly_rent</code>: monthly rent in ringgit malaysia (RM)</li>
<li><code>location</code>: property location in Kuala Lumpur region</li>
<li><code>property_type</code>:property type such as apartment, condominium, flat, duplex, studio, etc</li>
<li><code>rooms</code>: number of rooms in the unit</li>
<li><code>parking</code>: number of parking space for the unit</li>
<li><code>bathroom</code>: number of bathrooms in the unit</li>
<li><code>size</code>: total area of the unit in square feet</li>
<li><code>furnished</code>: furnishing status of the unit (fully, partial, non-furnished)</li>
<li><code>facilities</code>: main facilities available</li>
<li><code>additional_facilities</code>: additional facilities (proximity to attraction area, mall, school, shopping, railways, etc)</li>
</ul>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h3>
<p>The cleaning process mainly related to extracting the value out of column. E.g. extracting monthly rent of 1400 from a string of “1400 RM”, etc.</p>
<div class="cell" data-execution_count="2">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#removing RM from monthly rent</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>df[<span class="st">'monthly_rent'</span>] <span class="op">=</span> df[<span class="st">'monthly_rent'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(re.search(<span class="vs">r'RM (.*?) per'</span>, x).group(<span class="dv">1</span>).replace(<span class="st">' '</span>, <span class="st">''</span>)))</span>
<span id="cb2-3"><a href="#cb2-3"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'monthly_rent'</span>: <span class="st">'monthly_rent_rm'</span>})</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#dropping sq.ft from size</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>df[<span class="st">'size'</span>] <span class="op">=</span> df[<span class="st">'size'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(re.search(<span class="vs">r'(.*?) sq'</span>, x).group(<span class="dv">1</span>).replace(<span class="st">' '</span>, <span class="st">''</span>)))</span>
<span id="cb2-7"><a href="#cb2-7"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'size'</span>: <span class="st">'size_sqft'</span>})</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#dropping kuala lumpur from the location</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>df[<span class="st">'location'</span>] <span class="op">=</span> df[<span class="st">'location'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.findall(<span class="st">"\w+$"</span>, x)[<span class="dv">0</span>])</span>
<span id="cb2-11"><a href="#cb2-11"></a>df.head(<span class="dv">2</span>).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ads_id</th>
      <td>100323185</td>
      <td>100203973</td>
    </tr>
    <tr>
      <th>prop_name</th>
      <td>The Hipster @ Taman Desa</td>
      <td>Segar Courts</td>
    </tr>
    <tr>
      <th>completion_year</th>
      <td>2022.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>monthly_rent_rm</th>
      <td>4200</td>
      <td>2300</td>
    </tr>
    <tr>
      <th>location</th>
      <td>Desa</td>
      <td>Cheras</td>
    </tr>
    <tr>
      <th>property_type</th>
      <td>Condominium</td>
      <td>Condominium</td>
    </tr>
    <tr>
      <th>rooms</th>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>parking</th>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>bathroom</th>
      <td>6.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>size_sqft</th>
      <td>1842</td>
      <td>1170</td>
    </tr>
    <tr>
      <th>furnished</th>
      <td>Fully Furnished</td>
      <td>Partially Furnished</td>
    </tr>
    <tr>
      <th>facilities</th>
      <td>Minimart, Gymnasium, Security, Playground, Swimming Pool, Parking, Lift, Barbeque area, Multipurpose hall, Jogging Track</td>
      <td>Playground, Parking, Barbeque area, Security, Jogging Track, Swimming Pool, Gymnasium, Lift, Sauna</td>
    </tr>
    <tr>
      <th>additional_facilities</th>
      <td>Air-Cond, Cooking Allowed, Washing Machine</td>
      <td>Air-Cond, Cooking Allowed, Near KTM/LRT</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<p>Following the works from others, author will be focusing on using Random Forest and Gradient Boosting for the two main machine learning model to try to compare to baseline (average, and linear regression).</p>
<ul>
<li>Baseline using average means that the prediction will be using average value of the train target value. This yield a zero R2-score and the highest MAE value which will not be used as comparison in the following discussion.</li>
</ul>
<p>The author will mainly talking about baseline using linear regression. Linear regression is one of the machine learning model, where the model objective is to minimize the total error (distance) of each predicted value against the actual value.</p>
<p>The comparable model will be using Random Forest and Gradient Boosting.</p>
<p>A gradient boosting uses iterative process to assign weights to different sample, until the model predicts the target correctly. Meanwhile, Random Forest use similar concept, but the sampling and feature selection are random, therefore reduces both bias and variance in the model.</p>
</section>
<section id="experiments" class="level2">
<h2 class="anchored" data-anchor-id="experiments">Experiments</h2>
<p>The experiments mostly related to the data preparation before getting into modeling. The most author spent time with is feature selection and outlier removal. One of the insight when doing feature selection is the proximity to nearby railways (KTM/LRT) is likely to affect the increase of rent price. However, the finding is that the listing is inconsistent, the same property may listed to be ‘near KTM/LRT’, but the other rows were not.</p>
<section id="extracting-near-ktmlrt" class="level3">
<h3 class="anchored" data-anchor-id="extracting-near-ktmlrt">Extracting Near KTM/LRT</h3>
<div class="cell" data-execution_count="3">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">#extracting near KTM/LRT from the additional facilities</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">def</span> extract_near_ktm_lrt(text):</span>
<span id="cb3-3"><a href="#cb3-3"></a>    pattern <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r'\bNear KTM/LRT\b'</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="cf">try</span>:</span>
<span id="cb3-5"><a href="#cb3-5"></a>        match <span class="op">=</span> pattern.search(text)</span>
<span id="cb3-6"><a href="#cb3-6"></a>        <span class="cf">if</span> match:</span>
<span id="cb3-7"><a href="#cb3-7"></a>            <span class="cf">return</span> <span class="st">'yes'</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>        <span class="cf">return</span> <span class="st">'no'</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="cf">except</span> <span class="pp">TypeError</span>:</span>
<span id="cb3-10"><a href="#cb3-10"></a>        <span class="cf">return</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>df[<span class="st">'nearby_railways'</span>] <span class="op">=</span> df.additional_facilities.<span class="bu">apply</span>(<span class="kw">lambda</span> x: extract_near_ktm_lrt(x))</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>fig, axs <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb4-4"><a href="#cb4-4"></a>sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'monthly_rent_rm'</span>, y<span class="op">=</span><span class="st">'nearby_railways'</span>, ax<span class="op">=</span>axs)</span>
<span id="cb4-5"><a href="#cb4-5"></a>plt.xlim(<span class="dv">0</span>,<span class="dv">4000</span>)<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>near_ktmlrt <span class="op">=</span> df.query(<span class="st">" nearby_railways == 'yes' "</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a>not_near_ktmlrt <span class="op">=</span> df.query(<span class="st">" nearby_railways == 'no' "</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="bu">print</span>(<span class="ss">f""" </span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="ss">Median:</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="ss">Nearby KTM/LRT: </span><span class="sc">{</span>near_ktmlrt<span class="sc">.</span>monthly_rent_rm<span class="sc">.</span>median()<span class="sc">:.0f}</span><span class="ss">RM</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="ss">Not nearby KTM/LRT: </span><span class="sc">{</span>not_near_ktmlrt<span class="sc">.</span>monthly_rent_rm<span class="sc">.</span>median()<span class="sc">:.0f}</span><span class="ss">RM</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="ss">      """</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 
Median:
Nearby KTM/LRT: 1650RM
Not nearby KTM/LRT: 1600RM
      </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-5-output-2.png" width="533" height="356"></p>
</div>
</div>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>df[df[<span class="st">'prop_name'</span>] <span class="op">==</span> <span class="st">'Majestic Maxim'</span>][[<span class="st">'nearby_railways'</span>]].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>nearby_railways
yes                166
no                  24
dtype: int64</code></pre>
</div>
</div>
<p>As seen above, nearby KTM/LRT is slightly increases the median monthly rent by 50RM, however near KTM/LRT is not appearing in all row even though the unit is the same building.</p>
</section>
<section id="drop-unnecessary-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="drop-unnecessary-missing-values">Drop Unnecessary Missing Values</h3>
<p>Some features such as <code>ads_id</code>, <code>prop_name</code>, <code>facilities</code> and <code>additional_facilities</code> would no longer needed after the previous process.</p>
<div class="cell" data-execution_count="6">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[</span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="st">'ads_id'</span>, </span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="st">'prop_name'</span>, </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="st">'facilities'</span>, </span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="st">'additional_facilities'</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="co"># 'nearby_railways',</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="co"># 'completion_year'</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>])</span>
<span id="cb8-9"><a href="#cb8-9"></a>df.head(<span class="dv">2</span>).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>completion_year</th>
      <td>2022.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>monthly_rent_rm</th>
      <td>4200</td>
      <td>2300</td>
    </tr>
    <tr>
      <th>location</th>
      <td>Desa</td>
      <td>Cheras</td>
    </tr>
    <tr>
      <th>property_type</th>
      <td>Condominium</td>
      <td>Condominium</td>
    </tr>
    <tr>
      <th>rooms</th>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>parking</th>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>bathroom</th>
      <td>6.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>size_sqft</th>
      <td>1842</td>
      <td>1170</td>
    </tr>
    <tr>
      <th>furnished</th>
      <td>Fully Furnished</td>
      <td>Partially Furnished</td>
    </tr>
    <tr>
      <th>nearby_railways</th>
      <td>no</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="7">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">#converting rooms from object to int64 for plotting</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>df[<span class="st">'rooms'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'rooms'</span>], downcast<span class="op">=</span><span class="st">'integer'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 9991 entries, 0 to 9990
Data columns (total 10 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   completion_year  5618 non-null   float64
 1   monthly_rent_rm  9991 non-null   int64  
 2   location         9991 non-null   object 
 3   property_type    9991 non-null   object 
 4   rooms            9987 non-null   float64
 5   parking          7361 non-null   float64
 6   bathroom         9989 non-null   float64
 7   size_sqft        9991 non-null   int64  
 8   furnished        9990 non-null   object 
 9   nearby_railways  7160 non-null   object 
dtypes: float64(4), int64(2), object(4)
memory usage: 780.7+ KB</code></pre>
</div>
</div>
</section>
<section id="outlier-removal" class="level3">
<h3 class="anchored" data-anchor-id="outlier-removal">Outlier Removal</h3>
<p>Removing the outlier is extremely important, as some of these observation e.g.&nbsp;monthly rent, have astronomical rent value, far exceeding the median. After multiple iteration, below is the most-ideal limit for <code>size_sqft</code> and <code>monthly_rent_rm</code>.</p>
<div class="cell" data-execution_count="8">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>f, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb11-2"><a href="#cb11-2"></a>df[[<span class="st">'size_sqft'</span>, <span class="st">'monthly_rent_rm'</span>]].plot(kind<span class="op">=</span><span class="st">'scatter'</span>, </span>
<span id="cb11-3"><a href="#cb11-3"></a>                                          x<span class="op">=</span><span class="st">'size_sqft'</span>, </span>
<span id="cb11-4"><a href="#cb11-4"></a>                                          y<span class="op">=</span><span class="st">'monthly_rent_rm'</span>, </span>
<span id="cb11-5"><a href="#cb11-5"></a>                                          ax<span class="op">=</span>axs)<span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>plt.ylim(<span class="dv">100</span>,<span class="dv">5500</span>) <span class="co">#batas harga rent</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>plt.xlim(<span class="dv">50</span>,<span class="dv">3000</span>)  <span class="co">#batas size</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-9-output-1.png" width="544" height="356"></p>
</div>
</div>
<section id="monthly-rent" class="level4">
<h4 class="anchored" data-anchor-id="monthly-rent">Monthly Rent</h4>
<div class="cell" data-execution_count="9">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb12-2"><a href="#cb12-2"></a>axs[<span class="dv">0</span>].boxplot(data<span class="op">=</span>df, </span>
<span id="cb12-3"><a href="#cb12-3"></a>               x<span class="op">=</span><span class="st">'monthly_rent_rm'</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>axs[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>,<span class="dv">20000</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'all data'</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a>axs[<span class="dv">1</span>].boxplot(data<span class="op">=</span>df, </span>
<span id="cb12-8"><a href="#cb12-8"></a>               x<span class="op">=</span><span class="st">'monthly_rent_rm'</span>)</span>
<span id="cb12-9"><a href="#cb12-9"></a>axs[<span class="dv">1</span>].set_ylim(<span class="dv">100</span>,<span class="dv">5500</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'100-5,500 RM'</span>)</span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a>plt.tight_layout()</span>
<span id="cb12-13"><a href="#cb12-13"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-10-output-1.png" width="566" height="373"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">#removing all rows with monthly rent above 5500 RM and below 100RM</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>dfx <span class="op">=</span> df.query(<span class="st">" monthly_rent_rm &gt; 100 &amp; monthly_rent_rm &lt; 5500 "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="size" class="level4">
<h4 class="anchored" data-anchor-id="size">Size</h4>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a>axs[<span class="dv">0</span>].boxplot(data<span class="op">=</span>dfx, x<span class="op">=</span><span class="st">'size_sqft'</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>axs[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>,<span class="dv">20000</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'all data'</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>axs[<span class="dv">1</span>].boxplot(data<span class="op">=</span>dfx, x<span class="op">=</span><span class="st">'size_sqft'</span>)</span>
<span id="cb14-7"><a href="#cb14-7"></a>axs[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>,<span class="dv">2000</span>)</span>
<span id="cb14-8"><a href="#cb14-8"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'50-3,000 square feet'</span>)</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a>plt.tight_layout()</span>
<span id="cb14-11"><a href="#cb14-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-12-output-1.png" width="470" height="373"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">#removing outliers below 500, and higher than 3000 sqft and below 50 sqft</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>dfx <span class="op">=</span> dfx.query(<span class="st">" size_sqft &gt; 50 &amp; size_sqft &lt; 3000 "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data Preparation</h3>
<section id="preprocessing-original-data-for-categorical-dtypes" class="level4">
<h4 class="anchored" data-anchor-id="preprocessing-original-data-for-categorical-dtypes">Preprocessing Original Data for Categorical Dtypes</h4>
<p>One must paying attention to the number of categorical observation in the original data, with respect to the sampling train-test value. If, the test_size = 0.3, that means any categorical observation with a total of 3 and less, would not be distributed evenly among train and test data. Below is the process of removing some observation in which appearing only in one of the dataset (train/ test).</p>
<div class="cell" data-execution_count="13">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>dfx_new <span class="op">=</span> dfx[</span>
<span id="cb16-2"><a href="#cb16-2"></a>    (dfx.location <span class="op">!=</span> <span class="st">'Jinjang'</span>) </span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="op">&amp;</span> (dfx.location <span class="op">!=</span> <span class="st">'Serdang'</span>) <span class="op">&amp;</span> </span>
<span id="cb16-4"><a href="#cb16-4"></a>    (dfx.location <span class="op">!=</span> <span class="st">'Sentral'</span>) <span class="op">&amp;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>    (dfx.location <span class="op">!=</span> <span class="st">'Others'</span>) <span class="op">&amp;</span> </span>
<span id="cb16-6"><a href="#cb16-6"></a>    (dfx.location <span class="op">!=</span> <span class="st">'Tunku'</span>) <span class="op">&amp;</span> </span>
<span id="cb16-7"><a href="#cb16-7"></a>    (dfx.location <span class="op">!=</span> <span class="st">'Penchala'</span>) <span class="op">&amp;</span> </span>
<span id="cb16-8"><a href="#cb16-8"></a>    (dfx.location <span class="op">!=</span> <span class="st">'Lin'</span>) <span class="op">&amp;</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>    <span class="co"># (dfx.property_type != 'Others') &amp;</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>    (dfx.property_type <span class="op">!=</span> <span class="st">'Condo / Services residence / Penthouse / Townhouse'</span>) <span class="op">&amp;</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>    (dfx.property_type <span class="op">!=</span> <span class="st">'Townhouse Condo'</span>)</span>
<span id="cb16-12"><a href="#cb16-12"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="input-output" class="level4">
<h4 class="anchored" data-anchor-id="input-output">Input-Output</h4>
<div class="cell" data-execution_count="14">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">def</span> extractInputOutput(data,</span>
<span id="cb17-2"><a href="#cb17-2"></a>                       output_column_name):</span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="co">"""</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">    Fungsi untuk memisahkan data input dan output</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">    :param data: &lt;pandas dataframe&gt; data seluruh sample</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co">    :param output_column_name: &lt;string&gt; nama kolom output</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">    :return input_data: &lt;pandas dataframe&gt; data input</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">    :return output_data: &lt;pandas series&gt; data output</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">    """</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>    output_data <span class="op">=</span> data[output_column_name]</span>
<span id="cb17-11"><a href="#cb17-11"></a>    input_data <span class="op">=</span> data.drop(output_column_name,</span>
<span id="cb17-12"><a href="#cb17-12"></a>                           axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb17-13"><a href="#cb17-13"></a>    </span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="cf">return</span> input_data, output_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="15">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>X, y <span class="op">=</span> extractInputOutput(data<span class="op">=</span>dfx_new, </span>
<span id="cb18-2"><a href="#cb18-2"></a>                          output_column_name<span class="op">=</span><span class="st">'monthly_rent_rm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="train-test-split-data" class="level4">
<h4 class="anchored" data-anchor-id="train-test-split-data">Train-Test Split Data</h4>
<div class="cell" data-execution_count="16">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">#import libraries</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># Train test split</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y,</span>
<span id="cb19-6"><a href="#cb19-6"></a>                                                    test_size <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a>                                                    random_state <span class="op">=</span> <span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="training-data-imputation" class="level4">
<h4 class="anchored" data-anchor-id="training-data-imputation">Training Data Imputation</h4>
<section id="numerical-data" class="level5">
<h5 class="anchored" data-anchor-id="numerical-data">Numerical Data</h5>
<div class="cell" data-execution_count="17">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="kw">def</span> numericalImputation(X_train_num, </span>
<span id="cb20-4"><a href="#cb20-4"></a>                        strategy <span class="op">=</span> <span class="st">'most_frequent'</span>):</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="co">"""</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">    Fungsi untuk melakukan imputasi data numerik NaN</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">    :param data: &lt;pandas dataframe&gt; sample data input</span></span>
<span id="cb20-8"><a href="#cb20-8"></a></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co">    :return X_train_numerical: &lt;pandas dataframe&gt; data numerik</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">    :return imputer_numerical: numerical imputer method</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">    """</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>    <span class="co">#buat imputer</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>    imputer_num <span class="op">=</span> SimpleImputer(missing_values <span class="op">=</span> np.nan, </span>
<span id="cb20-14"><a href="#cb20-14"></a>                                strategy <span class="op">=</span> strategy)</span>
<span id="cb20-15"><a href="#cb20-15"></a>    </span>
<span id="cb20-16"><a href="#cb20-16"></a>    <span class="co">#fitting</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>    imputer_num.fit(X_train_num)</span>
<span id="cb20-18"><a href="#cb20-18"></a></span>
<span id="cb20-19"><a href="#cb20-19"></a>    <span class="co"># transform</span></span>
<span id="cb20-20"><a href="#cb20-20"></a>    imputed_data <span class="op">=</span> imputer_num.transform(X_train_num)</span>
<span id="cb20-21"><a href="#cb20-21"></a>    X_train_num_imputed <span class="op">=</span> pd.DataFrame(imputed_data)</span>
<span id="cb20-22"><a href="#cb20-22"></a></span>
<span id="cb20-23"><a href="#cb20-23"></a>    <span class="co">#pastikan index dan nama kolom antara imputed dan non-imputed SAMA</span></span>
<span id="cb20-24"><a href="#cb20-24"></a>    X_train_num_imputed.columns <span class="op">=</span> X_train_num.columns</span>
<span id="cb20-25"><a href="#cb20-25"></a>    X_train_num_imputed.index <span class="op">=</span> X_train_num.index</span>
<span id="cb20-26"><a href="#cb20-26"></a></span>
<span id="cb20-27"><a href="#cb20-27"></a>    <span class="cf">return</span> X_train_num_imputed, imputer_num</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="18">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>X_train_num <span class="op">=</span>  X_train.select_dtypes(exclude<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a>X_train_num, imputer_num <span class="op">=</span> numericalImputation(X_train_num, </span>
<span id="cb21-3"><a href="#cb21-3"></a>                                               strategy<span class="op">=</span><span class="st">'most_frequent'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="categorical-data" class="level5">
<h5 class="anchored" data-anchor-id="categorical-data">Categorical Data</h5>
<div class="cell" data-execution_count="19">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>X_train_cat <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a>X_train_cat, imputer_num <span class="op">=</span> numericalImputation(X_train_cat, </span>
<span id="cb22-3"><a href="#cb22-3"></a>                                               strategy<span class="op">=</span><span class="st">'most_frequent'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ohe-categorical-data" class="level5">
<h5 class="anchored" data-anchor-id="ohe-categorical-data">OHE Categorical Data</h5>
<div class="cell" data-execution_count="20">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">def</span> get_dum_n_concat(df_num, df_cat):</span>
<span id="cb23-2"><a href="#cb23-2"></a>    df_cat_ohe <span class="op">=</span> pd.get_dummies(df_cat)</span>
<span id="cb23-3"><a href="#cb23-3"></a>    ohe_columns <span class="op">=</span> df_cat_ohe.columns</span>
<span id="cb23-4"><a href="#cb23-4"></a>    df_concat <span class="op">=</span> pd.concat([df_num, df_cat_ohe], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="bu">print</span>(<span class="ss">f"Number of Cols: </span><span class="sc">{</span>df_concat<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">,</span><span class="ch">\n</span><span class="ss">Number of Null Rows: </span><span class="sc">{</span>df_concat<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a>    <span class="cf">return</span> ohe_columns, df_concat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="21">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>ohe_col, X_train_concat <span class="op">=</span> get_dum_n_concat(X_train_num, </span>
<span id="cb24-2"><a href="#cb24-2"></a>                                           X_train_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Cols: 63,
Number of Null Rows: completion_year                  0
rooms                            0
parking                          0
bathroom                         0
size_sqft                        0
                                ..
furnished_Fully Furnished        0
furnished_Not Furnished          0
furnished_Partially Furnished    0
nearby_railways_no               0
nearby_railways_yes              0
Length: 63, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="standarisasi" class="level5">
<h5 class="anchored" data-anchor-id="standarisasi">Standarisasi</h5>
<div class="cell" data-execution_count="22">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co"># Buat fungsi</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="kw">def</span> standardizerData(data):</span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="co">"""</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">    Fungsi untuk melakukan standarisasi data</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">    :param data: &lt;pandas dataframe&gt; sampel data</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">    :return standardized_data: &lt;pandas dataframe&gt; sampel data standard</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">    :return standardizer: method untuk standardisasi data</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co">    """</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>    data_columns <span class="op">=</span> data.columns  <span class="co"># agar nama kolom tidak hilang</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>    data_index <span class="op">=</span> data.index  <span class="co"># agar index tidak hilang</span></span>
<span id="cb26-13"><a href="#cb26-13"></a></span>
<span id="cb26-14"><a href="#cb26-14"></a>    <span class="co"># buat (fit) standardizer</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>    standardizer <span class="op">=</span> StandardScaler()</span>
<span id="cb26-16"><a href="#cb26-16"></a>    standardizer.fit(data)</span>
<span id="cb26-17"><a href="#cb26-17"></a></span>
<span id="cb26-18"><a href="#cb26-18"></a>    <span class="co"># transform data</span></span>
<span id="cb26-19"><a href="#cb26-19"></a>    standardized_data_raw <span class="op">=</span> standardizer.transform(data)</span>
<span id="cb26-20"><a href="#cb26-20"></a>    standardized_data <span class="op">=</span> pd.DataFrame(standardized_data_raw)</span>
<span id="cb26-21"><a href="#cb26-21"></a>    standardized_data.columns <span class="op">=</span> data_columns</span>
<span id="cb26-22"><a href="#cb26-22"></a>    standardized_data.index <span class="op">=</span> data_index</span>
<span id="cb26-23"><a href="#cb26-23"></a></span>
<span id="cb26-24"><a href="#cb26-24"></a>    <span class="cf">return</span> standardized_data, standardizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="23">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>X_train_clean, standardizer <span class="op">=</span> standardizerData(data <span class="op">=</span> X_train_concat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="training-machine-learning" class="level4">
<h4 class="anchored" data-anchor-id="training-machine-learning">Training Machine Learning</h4>
<section id="baseline-with-mean-value" class="level5">
<h5 class="anchored" data-anchor-id="baseline-with-mean-value">Baseline with Mean value</h5>
<div class="cell" data-execution_count="24">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">#baseline</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>y_baseline <span class="op">=</span> np.ones(<span class="bu">len</span>(y_train)) <span class="op">*</span> y_train.mean()</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co"># Predict using the train data</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>y_pred_train_mean <span class="op">=</span> y_baseline</span>
<span id="cb28-9"><a href="#cb28-9"></a></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>r2_baseline <span class="op">=</span> r2_score(y_train, </span>
<span id="cb28-12"><a href="#cb28-12"></a>                       y_pred_train_mean)</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="co">#calculate MAE</span></span>
<span id="cb28-15"><a href="#cb28-15"></a>mae_baseline <span class="op">=</span> mean_absolute_error(y_train, </span>
<span id="cb28-16"><a href="#cb28-16"></a>                                   y_pred_train_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="linear-regression" class="level5">
<h5 class="anchored" data-anchor-id="linear-regression">Linear Regression</h5>
<div class="cell" data-execution_count="25">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># Train the linear regression model</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>lin_reg <span class="op">=</span> LinearRegression().fit(X_train_clean, </span>
<span id="cb29-6"><a href="#cb29-6"></a>                                 y_train)</span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="co"># Predict using the train data</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>y_pred_train_linreg <span class="op">=</span> lin_reg.predict(X_train_clean)</span>
<span id="cb29-10"><a href="#cb29-10"></a></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="co"># Calculate mean absolute error</span></span>
<span id="cb29-12"><a href="#cb29-12"></a>mae_linreg <span class="op">=</span> mean_absolute_error(y_train, </span>
<span id="cb29-13"><a href="#cb29-13"></a>                                 y_pred_train_linreg)</span>
<span id="cb29-14"><a href="#cb29-14"></a></span>
<span id="cb29-15"><a href="#cb29-15"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>r2_linreg <span class="op">=</span> r2_score(y_train, </span>
<span id="cb29-17"><a href="#cb29-17"></a>                     y_pred_train_linreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gradientboosting" class="level5">
<h5 class="anchored" data-anchor-id="gradientboosting">GradientBoosting</h5>
<div class="cell" data-execution_count="26">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingRegressor</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co"># Build random forest</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>grad_tree <span class="op">=</span> GradientBoostingRegressor(random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="co"># Fit random forest</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>grad_tree.fit(X_train_clean, y_train)</span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co"># Predict</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>y_pred_train_gb <span class="op">=</span> grad_tree.predict(X_train_clean)</span>
<span id="cb30-10"><a href="#cb30-10"></a></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co"># Calculate mean absolute error</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>mae_gb <span class="op">=</span> mean_absolute_error(y_train, </span>
<span id="cb30-13"><a href="#cb30-13"></a>                             y_pred_train_gb)</span>
<span id="cb30-14"><a href="#cb30-14"></a></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>r2_gb <span class="op">=</span> r2_score(y_train, </span>
<span id="cb30-17"><a href="#cb30-17"></a>                 y_pred_train_gb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="27">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">#gridsearch</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV </span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>params <span class="op">=</span> {<span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>],</span>
<span id="cb31-5"><a href="#cb31-5"></a>              <span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.01</span>]}</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co"># Buat gridsearch</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>grad_tree <span class="op">=</span> GradientBoostingRegressor(random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a>grad_tree_cv <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> grad_tree,</span>
<span id="cb31-11"><a href="#cb31-11"></a>                           param_grid <span class="op">=</span> params,</span>
<span id="cb31-12"><a href="#cb31-12"></a>                           cv <span class="op">=</span> <span class="dv">5</span>,</span>
<span id="cb31-13"><a href="#cb31-13"></a>                           scoring <span class="op">=</span> <span class="st">"neg_mean_absolute_error"</span>)</span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co"># Fit grid search cv</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>grad_tree_cv.fit(X_train_clean, </span>
<span id="cb31-16"><a href="#cb31-16"></a>                 y_train)</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co"># Best params</span></span>
<span id="cb31-19"><a href="#cb31-19"></a>grad_tree_cv.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>{'learning_rate': 0.1, 'n_estimators': 500}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Refit the GB</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>grad_tree <span class="op">=</span> GradientBoostingRegressor(n_estimators <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb33-3"><a href="#cb33-3"></a>                                      learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>                                      random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a>grad_tree.fit(X_train_clean, </span>
<span id="cb33-7"><a href="#cb33-7"></a>              y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="68">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GradientBoostingRegressor(n_estimators=500, random_state=123)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">GradientBoostingRegressor</label><div class="sk-toggleable__content"><pre>GradientBoostingRegressor(n_estimators=500, random_state=123)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="29">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Predict</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>y_pred_train_gbcv <span class="op">=</span> grad_tree.predict(X_train_clean)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># Calculate mean absolute error</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>mae_gb_cv <span class="op">=</span> mean_absolute_error(y_train, </span>
<span id="cb34-6"><a href="#cb34-6"></a>                                y_pred_train_gbcv)</span>
<span id="cb34-7"><a href="#cb34-7"></a></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>r2_gb_cv <span class="op">=</span> r2_score(y_train, </span>
<span id="cb34-10"><a href="#cb34-10"></a>                    y_pred_train_gbcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="random-forest" class="level5">
<h5 class="anchored" data-anchor-id="random-forest">Random Forest</h5>
<div class="cell" data-execution_count="30">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Build random forest</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb35-3"><a href="#cb35-3"></a>rf_tree <span class="op">=</span> RandomForestRegressor(n_estimators <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb35-4"><a href="#cb35-4"></a>                                criterion <span class="op">=</span> <span class="st">"squared_error"</span>,</span>
<span id="cb35-5"><a href="#cb35-5"></a>                                max_features <span class="op">=</span> <span class="st">"sqrt"</span>,</span>
<span id="cb35-6"><a href="#cb35-6"></a>                                random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb35-7"><a href="#cb35-7"></a></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="co"># Fit random forest</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>rf_tree.fit(X_train_clean, </span>
<span id="cb35-10"><a href="#cb35-10"></a>            y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="70">
<style>#sk-container-id-5 {color: black;background-color: white;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor(max_features='sqrt', random_state=123)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(max_features='sqrt', random_state=123)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="31">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Predict</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>y_pred_train_rf <span class="op">=</span> rf_tree.predict(X_train_clean)</span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="co"># Calculate mean absolute error</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>mae_rf <span class="op">=</span> mean_absolute_error(y_train, </span>
<span id="cb36-6"><a href="#cb36-6"></a>                             y_pred_train_rf)</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>r2_rf <span class="op">=</span> r2_score(y_train, </span>
<span id="cb36-10"><a href="#cb36-10"></a>                 y_pred_train_rf)</span>
<span id="cb36-11"><a href="#cb36-11"></a></span>
<span id="cb36-12"><a href="#cb36-12"></a><span class="bu">print</span>(<span class="ss">f"R2-score: </span><span class="sc">{</span>r2_rf<span class="sc">:.4f}</span><span class="ss"> and MAE score: </span><span class="sc">{</span>mae_rf<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R2-score: 0.9577 and MAE score: 100.8408</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a><span class="co">#gridsearch</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>params <span class="op">=</span> {<span class="st">"n_estimators"</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">500</span> ],</span>
<span id="cb38-3"><a href="#cb38-3"></a>          <span class="st">"max_features"</span>: [<span class="st">"sqrt"</span>, <span class="st">"log2"</span>]}</span>
<span id="cb38-4"><a href="#cb38-4"></a></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="co"># Buat gridsearch</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>rf_tree <span class="op">=</span> RandomForestRegressor(criterion <span class="op">=</span> <span class="st">"squared_error"</span>,</span>
<span id="cb38-7"><a href="#cb38-7"></a>                                random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb38-8"><a href="#cb38-8"></a></span>
<span id="cb38-9"><a href="#cb38-9"></a>rf_tree_cv <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> rf_tree,</span>
<span id="cb38-10"><a href="#cb38-10"></a>                          param_grid <span class="op">=</span> params,</span>
<span id="cb38-11"><a href="#cb38-11"></a>                          cv <span class="op">=</span> <span class="dv">5</span>,</span>
<span id="cb38-12"><a href="#cb38-12"></a>                          scoring <span class="op">=</span> <span class="st">"neg_mean_absolute_error"</span>)</span>
<span id="cb38-13"><a href="#cb38-13"></a><span class="co"># Fit grid search cv</span></span>
<span id="cb38-14"><a href="#cb38-14"></a>rf_tree_cv.fit(X_train_clean, </span>
<span id="cb38-15"><a href="#cb38-15"></a>               y_train)</span>
<span id="cb38-16"><a href="#cb38-16"></a></span>
<span id="cb38-17"><a href="#cb38-17"></a><span class="co"># Best params</span></span>
<span id="cb38-18"><a href="#cb38-18"></a>rf_tree_cv.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>{'max_features': 'sqrt', 'n_estimators': 500}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Refit the Random Forest</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>rf_tree <span class="op">=</span> RandomForestRegressor(criterion <span class="op">=</span> <span class="st">"squared_error"</span>,</span>
<span id="cb40-3"><a href="#cb40-3"></a>                                max_features <span class="op">=</span> <span class="st">'sqrt'</span>,</span>
<span id="cb40-4"><a href="#cb40-4"></a>                                n_estimators <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>                                random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb40-6"><a href="#cb40-6"></a></span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="co">#refit</span></span>
<span id="cb40-8"><a href="#cb40-8"></a>rf_tree.fit(X_train_clean, </span>
<span id="cb40-9"><a href="#cb40-9"></a>            y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="73">
<style>#sk-container-id-6 {color: black;background-color: white;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor(max_features='sqrt', n_estimators=500, random_state=123)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" checked=""><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(max_features='sqrt', n_estimators=500, random_state=123)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="34">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Predict</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>y_pred_train_rfcv <span class="op">=</span> rf_tree.predict(X_train_clean)</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co"># Calculate mean absolute error</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>mae_rf_cv <span class="op">=</span> mean_absolute_error(y_train, </span>
<span id="cb41-6"><a href="#cb41-6"></a>                                y_pred_train_rfcv)</span>
<span id="cb41-7"><a href="#cb41-7"></a></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="co"># # Calculate R-squared</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>r2_rf_cv <span class="op">=</span> r2_score(y_train, </span>
<span id="cb41-10"><a href="#cb41-10"></a>                    y_pred_train_rfcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p><a href="#fig-model-comparison">Figure&nbsp;6</a> shows the result of all model tested on train dataset.</p>
<div>
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>sns.scatterplot(x<span class="op">=</span>y_train, </span>
<span id="cb42-2"><a href="#cb42-2"></a>                y<span class="op">=</span>y_pred_train_mean)</span>
<span id="cb42-3"><a href="#cb42-3"></a>plt.show()</span>
<span id="cb42-4"><a href="#cb42-4"></a>sns.scatterplot(x<span class="op">=</span>y_train, </span>
<span id="cb42-5"><a href="#cb42-5"></a>                y<span class="op">=</span>y_pred_train_linreg)</span>
<span id="cb42-6"><a href="#cb42-6"></a>plt.show()</span>
<span id="cb42-7"><a href="#cb42-7"></a>sns.scatterplot(x<span class="op">=</span>y_train, </span>
<span id="cb42-8"><a href="#cb42-8"></a>                y<span class="op">=</span>y_pred_train_gb)</span>
<span id="cb42-9"><a href="#cb42-9"></a>plt.show()</span>
<span id="cb42-10"><a href="#cb42-10"></a>sns.scatterplot(x<span class="op">=</span>y_train, </span>
<span id="cb42-11"><a href="#cb42-11"></a>                y<span class="op">=</span>y_pred_train_gbcv)</span>
<span id="cb42-12"><a href="#cb42-12"></a>plt.show()</span>
<span id="cb42-13"><a href="#cb42-13"></a>sns.scatterplot(x<span class="op">=</span>y_train, </span>
<span id="cb42-14"><a href="#cb42-14"></a>                y<span class="op">=</span>y_pred_train_rf)</span>
<span id="cb42-15"><a href="#cb42-15"></a>plt.show()</span>
<span id="cb42-16"><a href="#cb42-16"></a>sns.scatterplot(x<span class="op">=</span>y_train, </span>
<span id="cb42-17"><a href="#cb42-17"></a>                y<span class="op">=</span>y_pred_train_rfcv)</span>
<span id="cb42-18"><a href="#cb42-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-execution_count="35">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-model-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Mean</figcaption><p></p>
<p><img src="index_files/figure-html/fig-model-comparison-output-1.png" class="img-fluid figure-img" width="583"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-model-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Linear Regression</figcaption><p></p>
<p><img src="index_files/figure-html/fig-model-comparison-output-2.png" class="img-fluid figure-img" width="583"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-model-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Gradient Boosting</figcaption><p></p>
<p><img src="index_files/figure-html/fig-model-comparison-output-3.png" class="img-fluid figure-img" width="583"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-model-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Gradient Boosting with CV</figcaption><p></p>
<p><img src="index_files/figure-html/fig-model-comparison-output-4.png" class="img-fluid figure-img" width="583"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-model-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Random Forest</figcaption><p></p>
<p><img src="index_files/figure-html/fig-model-comparison-output-5.png" class="img-fluid figure-img" width="583"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-model-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Random Forest with CV</figcaption><p></p>
<p><img src="index_files/figure-html/fig-model-comparison-output-6.png" class="img-fluid figure-img" width="583"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<section id="best-model-from-train-dataset" class="level3">
<h3 class="anchored" data-anchor-id="best-model-from-train-dataset">Best Model from Train Dataset</h3>
<div class="cell" data-execution_count="36">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>mae_score <span class="op">=</span> [mae_baseline, mae_linreg, </span>
<span id="cb43-2"><a href="#cb43-2"></a>             mae_gb, mae_gb_cv,</span>
<span id="cb43-3"><a href="#cb43-3"></a>             mae_rf, mae_rf_cv]</span>
<span id="cb43-4"><a href="#cb43-4"></a></span>
<span id="cb43-5"><a href="#cb43-5"></a>r2_score <span class="op">=</span> [r2_baseline, r2_linreg, </span>
<span id="cb43-6"><a href="#cb43-6"></a>            r2_gb, r2_gb_cv, </span>
<span id="cb43-7"><a href="#cb43-7"></a>            r2_rf, r2_rf_cv]</span>
<span id="cb43-8"><a href="#cb43-8"></a></span>
<span id="cb43-9"><a href="#cb43-9"></a>indexes <span class="op">=</span> [<span class="st">"baseline"</span>, <span class="st">"linear regression"</span>, </span>
<span id="cb43-10"><a href="#cb43-10"></a>           <span class="st">"gradient boosting"</span>, <span class="st">"gradient boosting with CV"</span>,</span>
<span id="cb43-11"><a href="#cb43-11"></a>           <span class="st">"random forest"</span>,  <span class="st">"random forest with CV"</span>]</span>
<span id="cb43-12"><a href="#cb43-12"></a></span>
<span id="cb43-13"><a href="#cb43-13"></a>summary_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb43-14"><a href="#cb43-14"></a>    <span class="st">"MAE Train"</span>: mae_score,</span>
<span id="cb43-15"><a href="#cb43-15"></a>    <span class="st">"R2-Score"</span>: r2_score,</span>
<span id="cb43-16"><a href="#cb43-16"></a>},index <span class="op">=</span> indexes)</span>
<span id="cb43-17"><a href="#cb43-17"></a></span>
<span id="cb43-18"><a href="#cb43-18"></a><span class="co">#plotting</span></span>
<span id="cb43-19"><a href="#cb43-19"></a>fig, axs <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb43-20"><a href="#cb43-20"></a>                        nrows<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb43-21"><a href="#cb43-21"></a>                        figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>), </span>
<span id="cb43-22"><a href="#cb43-22"></a>                        sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-23"><a href="#cb43-23"></a></span>
<span id="cb43-24"><a href="#cb43-24"></a>summary_df.sort_values(by<span class="op">=</span><span class="st">'R2-Score'</span>, </span>
<span id="cb43-25"><a href="#cb43-25"></a>                       ascending<span class="op">=</span><span class="va">False</span>).plot(kind<span class="op">=</span><span class="st">'barh'</span>, </span>
<span id="cb43-26"><a href="#cb43-26"></a>                                             y<span class="op">=</span><span class="st">'R2-Score'</span>, </span>
<span id="cb43-27"><a href="#cb43-27"></a>                                             ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb43-28"><a href="#cb43-28"></a></span>
<span id="cb43-29"><a href="#cb43-29"></a>summary_df.sort_values(by<span class="op">=</span><span class="st">'R2-Score'</span>, </span>
<span id="cb43-30"><a href="#cb43-30"></a>                       ascending<span class="op">=</span><span class="va">False</span>).plot(kind<span class="op">=</span><span class="st">'barh'</span>, </span>
<span id="cb43-31"><a href="#cb43-31"></a>                                             y<span class="op">=</span><span class="st">'MAE Train'</span>, </span>
<span id="cb43-32"><a href="#cb43-32"></a>                                             ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb43-33"><a href="#cb43-33"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-r2-mae" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Comparison Chart of R2 and MAE for all Models</figcaption><p></p>
<p><img src="index_files/figure-html/fig-r2-mae-output-1.png" width="648" height="337" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="37">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>summary_df.applymap(<span class="kw">lambda</span> x: <span class="bu">round</span>(x, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="77">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>MAE Train</th>
      <th>R2-Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>baseline</th>
      <td>562.37</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>linear regression</th>
      <td>319.22</td>
      <td>0.65</td>
    </tr>
    <tr>
      <th>gradient boosting</th>
      <td>281.68</td>
      <td>0.72</td>
    </tr>
    <tr>
      <th>gradient boosting with CV</th>
      <td>228.02</td>
      <td>0.82</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>100.84</td>
      <td>0.96</td>
    </tr>
    <tr>
      <th>random forest with CV</th>
      <td>99.80</td>
      <td>0.96</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>After several model tested on the train dataset, Random Forest with Hyperparameter tuning has the best R2-score and MAE value as shown in the <a href="#fig-r2-mae">Figure&nbsp;7</a>. The best model plotted below as reference:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Best Model - RF with CV</figcaption><p></p>
<p><img src="best_model.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="applied-model-on-test-dataset" class="level3">
<h3 class="anchored" data-anchor-id="applied-model-on-test-dataset">Applied Model on Test Dataset</h3>
<div class="cell" data-execution_count="38">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># libraries</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a></span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="co">#setting up</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>rf_tree <span class="op">=</span> RandomForestRegressor(n_estimators <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb45-8"><a href="#cb45-8"></a>                                criterion <span class="op">=</span> <span class="st">"squared_error"</span>,</span>
<span id="cb45-9"><a href="#cb45-9"></a>                                max_features <span class="op">=</span> <span class="st">"sqrt"</span>,</span>
<span id="cb45-10"><a href="#cb45-10"></a>                                random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb45-11"><a href="#cb45-11"></a></span>
<span id="cb45-12"><a href="#cb45-12"></a><span class="co">#read cleaned test data</span></span>
<span id="cb45-13"><a href="#cb45-13"></a>X_test_clean <span class="op">=</span> pd.read_csv(<span class="st">"./X_test_clean.csv"</span>)</span>
<span id="cb45-14"><a href="#cb45-14"></a></span>
<span id="cb45-15"><a href="#cb45-15"></a><span class="co">#fit model train</span></span>
<span id="cb45-16"><a href="#cb45-16"></a>rf_tree.fit(X_train_clean, </span>
<span id="cb45-17"><a href="#cb45-17"></a>            y_train)</span>
<span id="cb45-18"><a href="#cb45-18"></a></span>
<span id="cb45-19"><a href="#cb45-19"></a><span class="co"># Predict model test</span></span>
<span id="cb45-20"><a href="#cb45-20"></a>y_pred_test <span class="op">=</span> rf_tree.predict(X_test_clean)</span>
<span id="cb45-21"><a href="#cb45-21"></a></span>
<span id="cb45-22"><a href="#cb45-22"></a><span class="co"># Calculate mean absolute error</span></span>
<span id="cb45-23"><a href="#cb45-23"></a>mae_rf_cv_test <span class="op">=</span> mean_absolute_error(y_test, </span>
<span id="cb45-24"><a href="#cb45-24"></a>                                     y_pred_test)</span>
<span id="cb45-25"><a href="#cb45-25"></a></span>
<span id="cb45-26"><a href="#cb45-26"></a><span class="co"># # Calculate R-squared</span></span>
<span id="cb45-27"><a href="#cb45-27"></a>r2_rf_cv_test <span class="op">=</span> r2_score(y_test, </span>
<span id="cb45-28"><a href="#cb45-28"></a>                         y_pred_test)</span>
<span id="cb45-29"><a href="#cb45-29"></a></span>
<span id="cb45-30"><a href="#cb45-30"></a><span class="bu">print</span>(<span class="ss">f"R2-score: </span><span class="sc">{</span>r2_rf_cv_test<span class="sc">:.3f}</span><span class="ss"> and MAE score: +/-</span><span class="sc">{</span>mae_rf_cv_test<span class="sc">:.2f}</span><span class="ss"> RM"</span>)</span>
<span id="cb45-31"><a href="#cb45-31"></a></span>
<span id="cb45-32"><a href="#cb45-32"></a>sns.scatterplot(x<span class="op">=</span>y_test, y<span class="op">=</span>y_pred_test )</span>
<span id="cb45-33"><a href="#cb45-33"></a>plt.plot([<span class="dv">0</span>, <span class="dv">5500</span>], [<span class="dv">0</span>,<span class="dv">5500</span>], <span class="st">"--r"</span>)</span>
<span id="cb45-34"><a href="#cb45-34"></a>plt.xlim(<span class="dv">0</span>, <span class="dv">5500</span>)</span>
<span id="cb45-35"><a href="#cb45-35"></a>plt.xlabel(<span class="st">"Actual Monthly Rent"</span>)</span>
<span id="cb45-36"><a href="#cb45-36"></a>plt.ylim(<span class="dv">0</span>,<span class="dv">5500</span>)</span>
<span id="cb45-37"><a href="#cb45-37"></a>plt.ylabel(<span class="st">"Predicted Monthly Rent"</span>)</span>
<span id="cb45-38"><a href="#cb45-38"></a>plt.suptitle(<span class="st">"Random Forest - Test Dataset"</span>)</span>
<span id="cb45-39"><a href="#cb45-39"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R2-score: 0.803 and MAE score: +/-214.08 RM</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-39-output-2.png" width="602" height="477"></p>
</div>
</div>
<div class="cell" data-execution_count="39">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>mae_score <span class="op">=</span> [mae_rf_cv,</span>
<span id="cb47-2"><a href="#cb47-2"></a>             mae_rf_cv_test]</span>
<span id="cb47-3"><a href="#cb47-3"></a></span>
<span id="cb47-4"><a href="#cb47-4"></a>r2_score <span class="op">=</span> [r2_rf_cv, </span>
<span id="cb47-5"><a href="#cb47-5"></a>            r2_rf_cv_test]</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>indexes <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"test"</span>]</span>
<span id="cb47-8"><a href="#cb47-8"></a></span>
<span id="cb47-9"><a href="#cb47-9"></a>summary_df_train_test <span class="op">=</span> pd.DataFrame({</span>
<span id="cb47-10"><a href="#cb47-10"></a>    <span class="st">"MAE Train"</span>: mae_score,</span>
<span id="cb47-11"><a href="#cb47-11"></a>    <span class="st">"R2-Score"</span>: r2_score,</span>
<span id="cb47-12"><a href="#cb47-12"></a>},index <span class="op">=</span> indexes)</span>
<span id="cb47-13"><a href="#cb47-13"></a></span>
<span id="cb47-14"><a href="#cb47-14"></a>summary_df_train_test.applymap(<span class="kw">lambda</span> x: <span class="bu">round</span>(x, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="79">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>MAE Train</th>
      <th>R2-Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>train</th>
      <td>99.80</td>
      <td>0.96</td>
    </tr>
    <tr>
      <th>test</th>
      <td>214.08</td>
      <td>0.80</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="feature-importance" class="level3">
<h3 class="anchored" data-anchor-id="feature-importance">Feature Importance</h3>
<div class="cell" data-execution_count="40">
<details open="">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># calculate the feature importances</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>importances <span class="op">=</span> rf_tree.feature_importances_</span>
<span id="cb48-3"><a href="#cb48-3"></a></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co"># rescale the importances back to the original scale of the features</span></span>
<span id="cb48-5"><a href="#cb48-5"></a>importances <span class="op">=</span> importances <span class="op">*</span> X_train_clean.std()</span>
<span id="cb48-6"><a href="#cb48-6"></a></span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="co"># sort the feature importances in descending order</span></span>
<span id="cb48-8"><a href="#cb48-8"></a>sorted_index <span class="op">=</span> importances.argsort()[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb48-9"><a href="#cb48-9"></a></span>
<span id="cb48-10"><a href="#cb48-10"></a><span class="co"># print the feature importances</span></span>
<span id="cb48-11"><a href="#cb48-11"></a>dict_feature_importance <span class="op">=</span> {}</span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="cf">for</span> i <span class="kw">in</span> sorted_index:</span>
<span id="cb48-13"><a href="#cb48-13"></a>    <span class="co"># print("{}: {}".format(X_train_clean.columns[i], importances[i]))</span></span>
<span id="cb48-14"><a href="#cb48-14"></a>    dict_feature_importance.update({X_train_clean.columns[i]: importances[i]})</span>
<span id="cb48-15"><a href="#cb48-15"></a>    </span>
<span id="cb48-16"><a href="#cb48-16"></a><span class="co"># Create a DataFrame from the dictionary</span></span>
<span id="cb48-17"><a href="#cb48-17"></a>df <span class="op">=</span> pd.DataFrame.from_dict(dict_feature_importance, orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>[<span class="st">'values'</span>])</span>
<span id="cb48-18"><a href="#cb48-18"></a></span>
<span id="cb48-19"><a href="#cb48-19"></a><span class="co"># Reset the index to become a column</span></span>
<span id="cb48-20"><a href="#cb48-20"></a>df <span class="op">=</span> df.reset_index()</span>
<span id="cb48-21"><a href="#cb48-21"></a></span>
<span id="cb48-22"><a href="#cb48-22"></a><span class="co"># Rename the columns</span></span>
<span id="cb48-23"><a href="#cb48-23"></a>df.columns <span class="op">=</span> [<span class="st">'feature'</span>, <span class="st">'importance_value'</span>]</span>
<span id="cb48-24"><a href="#cb48-24"></a></span>
<span id="cb48-25"><a href="#cb48-25"></a><span class="co">#plot</span></span>
<span id="cb48-26"><a href="#cb48-26"></a>fig, axs <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb48-27"><a href="#cb48-27"></a>(df</span>
<span id="cb48-28"><a href="#cb48-28"></a> .sort_values(by<span class="op">=</span><span class="st">'importance_value'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-29"><a href="#cb48-29"></a> .head(<span class="dv">10</span>)</span>
<span id="cb48-30"><a href="#cb48-30"></a> .sort_index(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-31"><a href="#cb48-31"></a> .plot(kind<span class="op">=</span><span class="st">'barh'</span>, x<span class="op">=</span><span class="st">'feature'</span>, ax<span class="op">=</span>axs)</span>
<span id="cb48-32"><a href="#cb48-32"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-41-output-1.png" width="685" height="337"></p>
</div>
</div>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<ol type="1">
<li><p>Result indicates that the best model for prediction is Random Forest with hyperparameter tuning, scoring 95% on R2-score, and a shy 100 RM on MAE. This proves to be a good model since the test dataset gives a scoring of 80% on R2, and 240 RM on MAE.</p></li>
<li><p>There are some factors that author believed to be affecting the result/ performance of the model:</p>
<ol type="1">
<li>Dropping missing value reduces the performance! Initial model uses half of the data (4-5k rows) and gives poorer performance on R2 and MAE. Imputation and keeping the number of rows close to the original dataset (9k rows) proves to be improving the model. Especially on test dataset.</li>
<li>Feature selection importance can be seen on the last table, but initially the selection was based on paper and intuition of the author (author lives and work in KL, Malaysia for 5 years). Feature such as <code>completion_year</code> and <code>nearby_railways</code> are important in improving the model.</li>
<li>Last but not least is the outlier identification. The best practice for me is using jointplot to see not only the distribution of the data in 2-dimension, but also in the third dimension (the density) of the data.</li>
</ol></li>
<li><p>Some insights after feature importance are the size plays a big role in determining the unit price, following size, the furniture availability apparently makes a big impact on the price. This gives an insight to owner of a unit to equip their unit with furniture to <code>fully_furnished</code> should they want to increase their unit market value.</p></li>
<li><p>Some of the feature that were believed to be quite important even before doing the modeling is <code>size_sqft</code>, <code>furnished</code> and <code>location</code>. All three is available within the 10-most features affecting the modeling. As a context, location in KLCC is like Pondok Indah in South Jakarta and location in Kiara is like BSD in South Tangerang, therefore it makes senses to see those locations increasing the price of a rent.</p></li>
</ol>
</section>
<section id="future-works" class="level2">
<h2 class="anchored" data-anchor-id="future-works">Future works</h2>
<ol type="1">
<li>One of the feature that author thinks is significant but not appearing on the 10-best important feature is <code>nearby_railways</code>. This column is showing if a certain property has a close proximity to a railways (KTM/LRT). The issue is, half of the data is missing, hence the imputation. Author believes, the proximity to nearby railways line can be approximated using Manhanttan distance of railways line to each property unit.</li>
</ol>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-madhuri2019" class="csl-entry" role="doc-biblioentry">
Madhuri, CH. Raga, G. Anuradha, and M. Vani Pujitha. 2019. <span>“House Price Prediction Using Regression Techniques: A Comparative Study.”</span> <em>2019 International Conference on Smart Structures and Systems (ICSSS)</em>, March. <a href="https://doi.org/10.1109/icsss.2019.8882834">https://doi.org/10.1109/icsss.2019.8882834</a>.
</div>
<div id="ref-xu2022" class="csl-entry" role="doc-biblioentry">
Xu, Kevin, and Hieu Nguyen. 2022. <span>“Predicting Housing Prices and Analyzing Real Estate Market in the Chicago Suburbs Using Machine Learning.”</span> <a href="https://doi.org/10.48550/ARXIV.2210.06261">https://doi.org/10.48550/ARXIV.2210.06261</a>.
</div>
<div id="ref-zhao2022" class="csl-entry" role="doc-biblioentry">
Zhao, Yaping, Ramgopal Ravi, Shuhui Shi, Zhongrui Wang, Edmund Y. Lam, and Jichang Zhao. 2022. <span>“PATE: Property, Amenities, Traffic and Emotions Coming Together for Real Estate Price Prediction.”</span> <a href="https://doi.org/10.48550/ARXIV.2209.05471">https://doi.org/10.48550/ARXIV.2209.05471</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ariewijaya2023,
  author = {Aditya Arie Wijaya},
  title = {{Easy} {Report:} {Malaysia} {Property} {Pricing}},
  date = {2023-02-10},
  url = {ariewjy.github.io/posts/06-easy-report-machine-learning},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ariewijaya2023" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Aditya Arie Wijaya. 2023.<span>“ Easy Report: Malaysia Property
Pricing.”</span> February 10, 2023. <a href="https://ariewjy.github.io/posts/06-easy-report-machine-learning">ariewjy.github.io/posts/06-easy-report-machine-learning</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="ariewjy/ariewjy.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.quarto.org">Built w/ Quarto</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../license.html">License</a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>